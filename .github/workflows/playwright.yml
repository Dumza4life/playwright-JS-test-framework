name: Playwright Tests

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: 20
    - name: Install dependencies
      run: npm ci
    - name: Install Playwright browsers
      run: npx playwright install --with-deps
    - name: Run Playwright tests
      run: npx playwright test
      env:
        # API Test Data
        API_USERNAME: admin
        API_PASSWORD: password123
        
        # UI Test Data - SauceDemo Users
        STANDARD_USERNAME: standard_user
        STANDARD_PASSWORD: secret_sauce
        LOCKED_OUT_USERNAME: locked_out_user
        LOCKED_OUT_PASSWORD: secret_sauce
        PROBLEM_USERNAME: problem_user
        PROBLEM_PASSWORD: secret_sauce
        PERFORMANCE_GLITCH_USERNAME: performance_glitch_user
        PERFORMANCE_GLITCH_PASSWORD: secret_sauce
        ERROR_USERNAME: error_user
        ERROR_PASSWORD: secret_sauce
        VISUAL_USERNAME: visual_user
        VISUAL_PASSWORD: secret_sauce
        
        # Checkout Information
        CHECKOUT_FIRST_NAME: Ndumiso
        CHECKOUT_LAST_NAME: Mayisela
        CHECKOUT_ZIP_CODE: 12345
        
        # Booking Test Data
        BOOKING_FIRST_NAME: Jim
        BOOKING_LAST_NAME: Brown
        BOOKING_TOTAL_PRICE: 111
        BOOKING_DEPOSIT_PAID: true
        BOOKING_CHECKIN: 2024-01-01
        BOOKING_CHECKOUT: 2024-01-05
        BOOKING_ADDITIONAL_NEEDS: Breakfast
    - uses: actions/upload-artifact@v4
      if: always()
      with:
        name: playwright-report
        path: test-results/monocart-report.html
        retention-days: 30
